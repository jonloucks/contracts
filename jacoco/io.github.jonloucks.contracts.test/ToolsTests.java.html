<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ToolsTests.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">contracts</a> &gt; <a href="index.source.html" class="el_package">io.github.jonloucks.contracts.test</a> &gt; <span class="el_source">ToolsTests.java</span></div><h1>ToolsTests.java</h1><pre class="source lang-java linenums">package io.github.jonloucks.contracts.test;

import io.github.jonloucks.contracts.api.Contract;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.junit.jupiter.api.function.Executable;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.ValueSource;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import org.mockito.junit.jupiter.MockitoSettings;
import org.mockito.quality.Strictness;

import java.time.Duration;
import java.time.Instant;
import java.util.concurrent.atomic.AtomicInteger;

import static io.github.jonloucks.contracts.test.Tools.*;
import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;

@SuppressWarnings(&quot;CodeBlock2Expr&quot;)
@ExtendWith(MockitoExtension.class)
@MockitoSettings(strictness = Strictness.LENIENT)
public interface ToolsTests {
    
    @Test
    default void tools_Instantiate_Throws() {
<span class="fc" id="L30">        assertInstantiateThrows(Tools.class);</span>
<span class="fc" id="L31">    }</span>
    
    @Test
    default void tools_sanitize_WithNullEllipses_DoesNotThrow() {
<span class="fc" id="L35">        assertDoesNotThrow(() -&gt; sanitize((Executable[])null));</span>
<span class="fc" id="L36">    }</span>
    
    @Test
    default void tools_sanitize_WithNullElement_DoesNotThrow() {
<span class="fc" id="L40">        assertDoesNotThrow(() -&gt; sanitize((Executable)null ));</span>
<span class="fc" id="L41">    }</span>
    
    @Test
    default void tools_sanitize_WithSingeSanitize_Works(@Mock Executable sanitizer) throws Throwable {
<span class="fc" id="L45">        assertDoesNotThrow(() -&gt; sanitize(sanitizer));</span>
        
<span class="fc" id="L47">        verify(sanitizer, times(1)).execute();</span>
<span class="fc" id="L48">    }</span>
    
    @Test
    default void tools_sanitize_WithMany_Works(@Mock Executable sanitizer) throws Throwable {
<span class="fc" id="L52">        final Executable throwingSanitizer = () -&gt; { throw  new IllegalStateException(&quot;Oh My&quot;); };</span>
<span class="fc" id="L53">        assertDoesNotThrow(() -&gt; sanitize(throwingSanitizer, sanitizer, throwingSanitizer));</span>
        
<span class="fc" id="L55">        verify(sanitizer, times(1)).execute();</span>
<span class="fc" id="L56">    }</span>
    
    @Test
    default void tools_assertContract_Works() {
<span class="fc" id="L60">        final Contract&lt;String&gt; validContract = Contract.create(&quot;test&quot;);</span>
<span class="fc" id="L61">        final Contract.Config&lt;String&gt; validConfig = String.class::cast;</span>
        
<span class="pc" id="L63">        assertFails(() -&gt; Tools.assertContract(null, validConfig, &quot;abc&quot;));</span>
<span class="pc" id="L64">        assertFails(() -&gt; Tools.assertContract(validContract, null, &quot;abc&quot;));</span>
<span class="fc" id="L65">    }</span>
    
    @Test
    default void tools_assertThrown_Works() {
<span class="fc" id="L69">        final String validReason = &quot;reason&quot;;</span>
<span class="fc" id="L70">        final Throwable validCause = new RuntimeException(&quot;cause&quot;);</span>
<span class="fc" id="L71">        final Throwable validException = new RuntimeException(validReason);</span>
<span class="fc" id="L72">        final Throwable exceptionWithNullReason = new RuntimeException((String)null);</span>
<span class="fc" id="L73">        final Throwable validExceptionWithCause = new RuntimeException(validReason, validCause);</span>
<span class="fc" id="L74">        final Throwable unknownException = new RuntimeException(&quot;unknown&quot;);</span>
   
<span class="fc" id="L76">        assertAll(</span>
<span class="pc" id="L77">            () -&gt; assertFails(() -&gt; Tools.assertThrown(null, validCause, validReason)),</span>
            
<span class="pc" id="L79">            () -&gt; assertFails(() -&gt; Tools.assertThrown(validCause, null, null)),</span>
<span class="pc" id="L80">            () -&gt; assertFails(() -&gt; Tools.assertThrown(validCause, unknownException, null)),</span>
<span class="pc" id="L81">            () -&gt; assertFails(() -&gt; Tools.assertThrown(validCause, validCause, validReason)),</span>
            
<span class="pc" id="L83">            () -&gt; assertFails(() -&gt; Tools.assertThrown(exceptionWithNullReason, validCause, validReason)),</span>
<span class="fc" id="L84">            () -&gt; assertDoesNotThrow(() -&gt; Tools.assertThrown(validException, null, validReason)),</span>
<span class="pc" id="L85">            () -&gt; assertFails(() -&gt; Tools.assertThrown(validExceptionWithCause, null, validReason)),</span>
<span class="pc" id="L86">            () -&gt; assertFails(() -&gt; Tools.assertThrown(validExceptionWithCause, validCause, &quot;different&quot;)),</span>
<span class="fc" id="L87">            () -&gt; assertDoesNotThrow(() -&gt; Tools.assertThrown(validExceptionWithCause, validCause, validReason))</span>
        );
<span class="fc" id="L89">    }</span>
    
    @Test
    default void tools_assertInstantiateThrows_With() {
<span class="fc" id="L93">        final IllegalArgumentException thrown = assertThrows(IllegalArgumentException.class, ()-&gt; {</span>
<span class="nc" id="L94">            assertInstantiateThrows(null);</span>
<span class="nc" id="L95">        });</span>
<span class="fc" id="L96">        assertThrown(thrown);</span>
<span class="fc" id="L97">    }</span>
    
    @Test
    default void tools_assertInstantiate_WithPublic_Fails() {
<span class="pc" id="L101">        assertFails(() -&gt; assertInstantiateThrows(String.class));</span>
<span class="fc" id="L102">    }</span>
    
    @Test
    default void tools_assertObject_WithNull_Fails() {
<span class="pc" id="L106">        assertFails(()-&gt;assertObject(null));</span>
<span class="fc" id="L107">    }</span>
    
    @Test
    default void tools_assertObject_WithBadHashCode_Fails() {
<span class="fc" id="L111">        final Object object = new Object() {</span>
<span class="fc" id="L112">            private final AtomicInteger counter = new AtomicInteger();</span>
            @Override
            public int hashCode() {
<span class="fc" id="L115">                return counter.incrementAndGet();</span>
            }
        };
        
<span class="pc" id="L119">        assertFails(()-&gt;assertObject(object));</span>
<span class="fc" id="L120">    }</span>
    
    @Test
    default void tools_assertObject_WithNullToString_Fails() {
<span class="fc" id="L124">        final Object object = new Object() {</span>
            @Override
            public String toString() {
<span class="fc" id="L127">                return null;</span>
            }
        };
<span class="pc" id="L130">        assertFails(()-&gt;assertObject(object));</span>
<span class="fc" id="L131">    }</span>
    
    @Test
    default void tools_assertObject_BadEquals_Fails() {
<span class="fc" id="L135">        final Object object = new Object() {</span>
            @SuppressWarnings(&quot;EqualsDoesntCheckParameterClass&quot;)
            @Override
            public boolean equals(Object that) {
<span class="fc bfc" id="L139" title="All 2 branches covered.">                return null == that;</span>
            }
            @Override
            public int hashCode() {
<span class="fc" id="L143">                return 1;</span>
            }
        };
<span class="pc" id="L146">        assertFails(()-&gt;assertObject(object));</span>
<span class="fc" id="L147">    }</span>
    
    @Test
    default void tools_assertObject_WithString_Passes() {
<span class="fc" id="L151">        assertDoesNotThrow(() -&gt; {</span>
<span class="fc" id="L152">            assertObject(&quot;abc&quot;);</span>
<span class="fc" id="L153">        });</span>
<span class="fc" id="L154">    }</span>
    
    @Test
    default void tools_sleep_WithNullDuration_Throws() {
<span class="fc" id="L158">        final IllegalArgumentException thrown = assertThrows(IllegalArgumentException.class, ()-&gt; {</span>
<span class="nc" id="L159">            Tools.sleep(null);</span>
<span class="nc" id="L160">        });</span>
<span class="fc" id="L161">        assertThrown(thrown);</span>
<span class="fc" id="L162">    }</span>
    
    @ParameterizedTest(name = &quot;Duration {0} milliseconds&quot;)
    @ValueSource(ints = {0, 5, 10, 100, 200})
    default void tools_sleep_WithDuration(long milliseconds) {
<span class="fc" id="L167">        final Duration expectedDuration = Duration.ofMillis(milliseconds);</span>
<span class="fc" id="L168">        final Duration allowedDifference = Duration.ofMillis(10);</span>
<span class="fc" id="L169">        final Instant start = Instant.now();</span>
        
<span class="fc" id="L171">        Tools.sleep(expectedDuration);</span>
        
<span class="fc" id="L173">        final Duration actualDuration = Duration.between(start, Instant.now());</span>
        
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">        assertTrue(actualDuration.compareTo(expectedDuration) &gt;= 0);</span>
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">        assertTrue(actualDuration.minus(expectedDuration).compareTo(allowedDifference) &lt;= 0);</span>
<span class="fc" id="L177">    }</span>
    
    @ParameterizedTest(name = &quot;Duration {0} milliseconds&quot;)
    @ValueSource(ints = {-1, -2 })
    default void tools_sleep_WithInvalidDuration(long milliseconds) {
<span class="fc" id="L182">        final Duration expectedDuration = Duration.ofMillis(milliseconds);</span>
<span class="fc" id="L183">        final IllegalArgumentException thrown = assertThrows(IllegalArgumentException.class, () -&gt; {</span>
<span class="nc" id="L184">            Tools.sleep(expectedDuration);</span>
<span class="nc" id="L185">        });</span>
<span class="fc" id="L186">        assertThrown(thrown);</span>
<span class="fc" id="L187">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>